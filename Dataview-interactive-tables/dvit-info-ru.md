[Manual in english](https://github.com/anareaty/obsidian-snippets/blob/main/Dataview-interactive-tables/dvit-info-en.md)
# Интерактивные таблицы для Dataview

https://github.com/user-attachments/assets/0855c051-33db-4808-ac86-1928d32c5353

## Описание

Этот скрипт предназначен для использования в приложении Obsidian с плагином Dataview (также требуется плагин CustomJS). С помощью Dataview вы можете создавать таблицы и списки из заметок, но их нельзя редактировать. Этот скрипт позволяет вам создавать динамические интерактивные представления с несколькими дополнительными опциями:
- можно фильтровать таблицы по свойствам с помощью кнопок фильтрации;
- можно использовать пагинацию, чтобы разнести записи на отдельные страницы;
- можно легко переключаться между представлениями таблиц, карточек и списков;
- можно редактировать свойства прямо из таблицы, не открывая заметку;
- можно отображать свойства как изображения, функциональные чекбоксы и ползунки;
- можно использовать разные цвета для разных значений свойств;
- можно обновлять представление с помощью специальной кнопки;
- можно добавить кнопку для создания новой заметки;
- можно делать все это с минимальным редактированием кода.

## Как настроить

1. Установите плагин Dataview и включите javascript в настройках плагина.
2. Установите плагин CustomJS и настройте папку scripts в настройках плагина.
3. Загрузите файл [interactive-tables.js](https://github.com/anareaty/obsidian-snippets/blob/main/Dataview-interactive-tables/interactive-tables.js) и поместите его в папку scripts.
4. Загрузите файлы [dvit-cards.css](https://github.com/anareaty/obsidian-snippets/blob/main/Dataview-interactive-tables/dvit-cards.css) и [dvit-style.css](https://github.com/anareaty/obsidian-snippets/blob/main/Dataview-interactive-tables/dvit-style.css). Поместите их в папку ".obsidian/snippets" и включите сниппеты в настройках внешнего вида Obsidian.
5. Скопируйте код ниже в заметку Obsidian:

````
```dataviewjs

// Выберите и отфильтруйте страницы как обычно с помощью dataviewjs.

let pages = dv.pages()

// Общие настройки представления

const settings = {
    "entries on page": 10,
    "full width": true,
    "add new note button": true,
}

// Настройки свойств

const props = [
  {
    prop: "file.link", 
    name: "Name",
    filter: true,
    column: true
  },
  {
    prop: "tags",
    filter: true,
    column: true
  }
] 

await customJS.dvIT.renderView(settings, props, pages, dv)
```
````

6. Отредактируйте код в соответствии с вашими потребностями (см. ниже).

## Как редактировать

Вы можете изменить представление, отредактировав объект "settings" и массив "props".

### Общие настройки

Объект "settings" содержит общие настройки представления. Он может содержать несколько необязательных параметров:

`"entries on page": <number>` — описывает, сколько записей должно быть на одной странице. Если вы пропустите этот параметр, пагинации не будет.

`"full width": true` — если вы хотите, чтобы таблица заполняла всю ширину страницы.

`add new note button": true` - если вы хотите добавить кнопку для создания новой заметки.

Если вы добавляете кнопку для создания заметки, вы также можете добавить параметры для новой заметки (необязательно).

`new note name: <string>` - название новой заметки.

`new note folder: <string>` - папка для создания новой заметки.

`new note template: <string>` - шаблон заметки.

Вы также можете изменить положение изображений карточек, добавив:

`"cards image position": "horizontal"`

В результате ваши настройки могут выглядеть следующим образом, например:

```js
const settings = {
"entries on page": 10,
"cards image position": "horizontal",
"full width": true,
"add new note button": true,
"new note name": "New book",
"new note folder": "Books",
"new note template": "Book template"
}
```

### Настройки свойств

Массив "props" описывает, какие свойства отображаются в представлении. Каждое свойство имеет свой собственный объект, содержащий несколько атрибутов. Например:

```
{
  prop: "Имя свойства",
  filter: true,
  column: true
}
```
Вот некоторые параметры, которые вы можете добавить к объекту свойства:

`prop: <string>` — имя свойства (обязательно).

`filter: true` — добавляет сверху кнопку фильтрации для этого свойства.

`column: true` — добавляет столбец в таблице для этого свойства.

`name: <string>` — если вы хотите использовать альтернативное имя для этого свойства в заголовке таблицы и на кнопке фильтрации.

`icon: <string>` — если вы хотите добавить иконку к имени свойства в заголовке таблицы и на кнопке фильтрации. Поддерживаются только встроенные значки lucide. Например, `icon: "send"`.

`image: true` — свойство будет отображаться как изображение. Для этого оно должен содержать либо внешнюю url-ссылку, либо вики-ссылку на локальное изображение.

`width: <number>` — задает ширину изображения.

`fuzzySearch: true` — разрешает нечеткий поиск в модальном окне фильтрации.

`span: true` — оборачивает значения свойств в теги span с уникальными именами классов. Позволяет использовать css для добавления разных цветов для разных значений.

`multiSelect: true` — позволяет выбирать несколько значений в модальном окне фильтрации. Работает только со свойствами типа "список".

`editButton: "select"` — позволяет выбирать только один из существующих вариантов в модальном окне редактирования. Работает со свойствами типа "текст" или "список".

`slice: [0, 2],` — отображать только первые два символа значения свойства (полезно для свойств, начинающихся с эмодзи).

`textHeight: <number>` — задает максимальную высоту текстового свойства в таблице.

`alignBottom: true` — в представлении карточек сдвинуть это свойство и все свойства после него в нижнюю часть карточки.

`hideOnMobile: true` — не показывать это свойство в таблице на мобильном.

Помимо обычных свойств вы также можете использовать некоторые свойства файла, такие как "file.link" или "file.path". Обратите внимание, что большинство из них пока не редактируются, за исключением имени заметки. Вы можете использовать только свойства файла первого уровня.

Вы можете использовать свойство `file.tasks`, чтобы получить список задач из заметок с активными чекбоксами, а кнопка фильтрации позволит переключаться между просмотром всех задач, только выполненных или только не выполненных. Но поддержка задач пока что минимальна и может немного глючить.

Еще две штуки, кроме свойств, которые вы можете поместить в массив "props", это прогресс-бар и ползунок.

Прогресс-бар позволяет вам видеть прогресс выполнения всех задач в заметке. Он описывается следующим образом:

```
{
    prop: "taskProgress",
    column: true  
}
```

Ползунок позволяет редактировать свойства перетаскиванием. Это может быть полезно, например, для отслеживания того, сколько глав книги вы прочитали и т.д. Он описывается так:

```
  {
    prop: "slider",
    column: true,
    propVal: "Value",
    propMax: "Max"
}
```

Для ползунка требуются два свойства: максимальное значение и текущее значение. Если в заметке нет максимального значения, вы можете задать его, щелкнув по ячейке ползунка. Двойной щелчок по ползунку позволяет ввести значение как число.

## Дополнительные стили

Использование этого скрипта добавляет некоторые дополнительные свойства в заметку с представлением. Они необходимы для хранения информации о фильтрах и других выбранных параметрах. При желании вы можете скрыть эти свойства, добавив css-snippet:

```css
/* Скрыть свойства интерактивной таблицы */

.metadata-property[data-property-key*="filter"],
.metadata-property[data-property-key="view"],
.metadata-property[data-property-key="pagination"],
.metadata-property[data-property-key="search"],
.metadata-property[data-property-key="show_search"] {
  display: none;
}
```

Вы также можете использовать css для изменения цветов определенных значений свойств. Для этого необходимо добавить параметр `span: true` к объекту свойства. Затем необходимо создать css-сниппет. Например, у вас есть свойство «Статус» с возможными значениями «в процессе» и «завершено», и вы хотите, чтобы «в процессе» выделялось красным, а «завершено» — зеленым цветом. Вы можете использовать такой css:

```css
.dv-tag-в-процессе {
background-color: rgba(var(--color-red-rgb), .2);
}

.dv-tag-завершено {
background-color: rgba(var(--color-green-rgb), .2);
}
```

Обратите внимание, что все пробелы должны быть заменены дефисы.
